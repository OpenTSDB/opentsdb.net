<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>TSDB Configuration &#8212; OpenTSDB 3.0 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Logging" href="logging.html" />
    <link rel="prev" title="Administrators Guide" href="index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><span><img src="../_static/opentsdb_logo_square_sm.png"></span>
          OpenTSDB</a>
        <span class="navbar-text navbar-version pull-left"><b>3.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://github.com/OpenTSDB/opentsdb/releases">Download</a></li>
                <li><a href="https://github.com/OpenTSDB/opentsdb">Source</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Documentation <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../changes.html">Changes in 3.0</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../changes.html#new-features">New Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changes.html#whats-missing">Whats Missing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation and Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#runtime-requirements">Runtime Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#compile">Compile</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#docker">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#local">Local</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#id1">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#querying">Querying</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/index.html">Users Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../user_guide/semanticquery/index.html">Semantic Query (Version 3)</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Administrators Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">TSDB Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api_http/index.html">HTTP API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#version-2-x-to-3-x">Version 2.X to 3.x</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#authentication-permissions">Authentication/Permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#response-codes">Response Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#errors">Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#verbs">Verbs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#query-string-vs-body-content">Query String Vs. Body Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#compressed-requests">Compressed Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#cors">CORS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#deprecated-api">Deprecated API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#api-endpoints">API Endpoints</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="index.html" title="Previous Chapter: Administrators Guide"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Administrators Guide</span>
    </a>
  </li>
  <li>
    <a href="logging.html" title="Next Chapter: Logging"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Logging &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">TSDB Configuration</a><ul>
<li><a class="reference internal" href="#overview">Overview</a><ul>
<li><a class="reference internal" href="#default-providers">Default Providers</a></li>
<li><a class="reference internal" href="#plugin-location">Plugin Location</a></li>
<li><a class="reference internal" href="#bootstrapping">Bootstrapping</a></li>
<li><a class="reference internal" href="#reloading">Reloading</a></li>
</ul>
</li>
<li><a class="reference internal" href="#plugin-and-module-configuration">Plugin and Module Configuration</a><ul>
<li><a class="reference internal" href="#configs">configs</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="tsdb-configuration">
<h1>TSDB Configuration</h1>
<p>As of 3.0 OpenTSDB has a much more flexible configuration system with features like:</p>
<ul class="simple">
<li>Dynamic updates of configuration parameters to avoid JVM restarts (depends on the specific config)</li>
<li>Secure key/value support like AWS Secrets</li>
<li>Combining multiple configuration sources</li>
<li>Configs via HTTP to for containerized deployments</li>
<li>YAML or JSON support for objec configurations</li>
<li>Plugins</li>
</ul>
<div class="section" id="overview">
<h2>Overview</h2>
<p>OpenTSDB is now configured via one or more sources that are flattened into a single application wide configuration consisting of keys and values. Multiple sources can be provided with the same keys but different values and later values will override the earlier values. As an example, a common config may be available over HTTP with many settings but a local config may override some of those settings for a specific environment.</p>
<p>Available built-in providers include:</p>
<ul class="simple">
<li><strong>Environment</strong> - Environment variables can be set with keys and values, useful in a containerized environment.</li>
<li><strong>System Properties</strong> - JVM properties can be parsed such as those given over the command line in the <cite>-Dmy.key=my.value</cite> format.</li>
<li><strong>Command Line</strong> - Traditional command line arguments like <cite>--my.key=my.value</cite></li>
<li><strong>YAML/JSON File</strong> - Either a local file or available over HTTP(S). Suffixes supported include <cite>.yaml, .yml, .json, .jsn</cite>.</li>
<li><strong>Java Properties File</strong> - Either a local file or available over HTTP(S). Suffixes supported include <cite>.conf, .config, .txt, .properties</cite>.</li>
<li><strong>Secrets Support</strong> - A plugin to load encrypted values from a secure location like Amazon's AWS Secrets, a local key vault or other secure locations. Useful for credential storage.</li>
</ul>
<p>The <cite>config.providers</cite> key is used to set the providers and order that they're loaded in. Providers are separated by commas and the last configuration in the list is loaded first, with earlier configs over-ridding the later configs (<strong>NOTE:</strong> If this is a pain we can reverse it before release, let us know what ya'll think). And example config may look like this:</p>
<p><cite>--config.providers=secrets://net.opentsdb.configuration.providers.AWSSecretsProvider:AWS,https://tsdbconfig.mysite.com/stage/elasticsearch.yaml,https://tsdbconfig.mysite.com/stage/tsdr.yaml,https://tsdbconfig.mysite.com/stage/hbase.yaml,https://tsdbconfig.mysite.com/stage/common.yaml</cite></p>
<p>With secrets, files and remote files, the configuration format uses protocols like <cite>https://</cite>, <cite>file://</cite> or <cite>secrets://</cite>. These protocols determine which plugin or built-in module parses the config. For remote and files, the suffix will also determine the parser.</p>
<p>Because multiple configurations are flattened into a single structure, key values in earlier providers will be overwritten by those in later providers. For example, lets assume the following providers config: <cite>--config.providers=https://tsdbconfig.mysite.com/stage/tsdr.yaml,https://tsdbconfig.mysite.com/stage/common.yaml</cite>.</p>
<p>Lets say <cite>https://tsdbconfig.mysite.com/stage/common.yaml</cite> contains:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">tsd.stats.environment</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">development</span>
</pre></div>
</div>
<p>and <cite>https://tsdbconfig.mysite.com/stage/tsdr.yaml</cite> defines</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">tsd.stats.environment</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">stage</span>
</pre></div>
</div>
<p>since we're in stage. The final value read by TSDB for <cite>tsd.stats.environment</cite> will be <cite>stage</cite>.</p>
<div class="section" id="default-providers">
<h3>Default Providers</h3>
<p>The default provider set is <cite>PropertiesFile,Environment,SystemProperties,CommandLine,RuntimeOverride</cite> where the properties file will automatically search for Java property formatted files in the following locations:</p>
<ul class="simple">
<li>/etc/opentsdb.conf</li>
<li>/etc/opentsdb/opentsdb.conf</li>
<li>/opt/opentsdb/opentsdb.conf</li>
</ul>
<p>This is useful when migrating from an OpenTSDB 2.0 config file.</p>
</div>
<div class="section" id="plugin-location">
<h3>Plugin Location</h3>
<p>When secrets need to be loaded (and particularly when they need to be used during bootstraping) a path to a plugin directory can be provided via the <cite>config.plugin.path</cite> key. For example <cite>--config.plugin.path=/usr/share/opentsdb/plugins</cite> can be given on the command line.</p>
</div>
<div class="section" id="bootstrapping">
<h3>Bootstrapping</h3>
<p>On TSD startup, the configuration class will look for <cite>config.providers</cite> and <cite>config.plugin.path</cite> in the following locations and take the first value found:</p>
<ul class="simple">
<li>Environment variable</li>
<li>System properties</li>
<li>Command line</li>
</ul>
</div>
<div class="section" id="reloading">
<h3>Reloading</h3>
<p>All file based or remote configurations will be reloaded, by default, every 5 minutes. To change the interval, set <cite>config.reload.interval</cite> to an integer in seconds. This feature allows for common tunnable parameters to be changed during runtime without having to restart the TSD.</p>
</div>
</div>
<div class="section" id="plugin-and-module-configuration">
<h2>Plugin and Module Configuration</h2>
<p>OpenTSDB is a flexible time series solution wherein a JVM can be configured as a query router or a data store. Therefore the most important configuration is the module config or <cite>tsd.plugin.config</cite>.</p>
<p>Many modules or plugins are loaded automatically, e.g. aggregators, query nodes like the downsampler or group by. But some modules, like data sources or authentication methods, must be configured by the administrator or they won't load. There are four sections to the <cite>tsd.plugin.config</cite>:</p>
<ul class="simple">
<li><strong>configs</strong> - This is a list of one or more plugin configuration definitions that will be loaded in the order they are defined. See the configs section below for details.</li>
<li><strong>pluginLocations</strong> - An optional list of directories in which to search for plugins (compiled as <cite>.jar</cite> files).</li>
<li><strong>continueOnError</strong> - Whether or not to allow the TSD to startup when an error is encountered trying to load a plugin.</li>
<li><strong>loadDefaultInstances</strong> - Whether or not to load default module instances.</li>
</ul>
<div class="section" id="configs">
<h3>configs</h3>
<p>Each module config entry is a map of keys and values with the following keys available:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Each config must include either a non-empty <cite>id</cite> or <cite>isDefault</cite> must be set to true.</p>
</div>
<p>Each module or plugin may have various configurations that are required for it to load properly. These configs can appear in any config source and in any order. The configuration is loaded and flattened prior to module initialization.</p>
<p>If a module has a dependency on another module, make sure the required module is listed <em>before</em> the dependent module in the configuration list.</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, OpenTSDB.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.7.<br/>
    </p>
  </div>
</footer>
  </body>
</html>