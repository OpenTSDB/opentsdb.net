<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Logging &#8212; OpenTSDB 3.0 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="HTTP API" href="../api_http/index.html" />
    <link rel="prev" title="TSDB Configuration" href="configuration.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          OpenTSDB</a>
        <span class="navbar-text navbar-version pull-left"><b>3.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://github.com/OpenTSDB/opentsdb/releases">Download</a></li>
                <li><a href="https://github.com/OpenTSDB/opentsdb">Source</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Documentation <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../changes.html">Changes in 3.0</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../changes.html#new-features">New Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../changes.html#whats-missing">Whats Missing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation and Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#runtime-requirements">Runtime Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#compile">Compile</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#docker">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#local">Local</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#id1">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#querying">Querying</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/index.html">Users Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../user_guide/semanticquery/index.html">Semantic Query (Version 3)</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Administrators Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="configuration.html">TSDB Configuration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Logging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api_http/index.html">HTTP API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#version-2-x-to-3-x">Version 2.X to 3.x</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#authentication-permissions">Authentication/Permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#response-codes">Response Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#errors">Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#verbs">Verbs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#query-string-vs-body-content">Query String Vs. Body Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#compressed-requests">Compressed Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#cors">CORS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#deprecated-api">Deprecated API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_http/index.html#api-endpoints">API Endpoints</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="configuration.html" title="Previous Chapter: TSDB Configuration"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; TSDB Configuration</span>
    </a>
  </li>
  <li>
    <a href="../api_http/index.html" title="Next Chapter: HTTP API"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">HTTP API &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Logging</a><ul>
<li><a class="reference internal" href="#configuration">Configuration</a><ul>
<li><a class="reference internal" href="#levels">Levels</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appenders">Appenders</a></li>
<li><a class="reference internal" href="#loggers">Loggers</a></li>
<li><a class="reference internal" href="#root">Root</a></li>
<li><a class="reference internal" href="#log-to-rotating-file">Log to Rotating File</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  <div class="section" id="logging">
<h1>Logging</h1>
<p>OpenTSDB uses the <a class="reference external" href="http://www.slf4j.org/">SLF4J</a> abstraction layer along with <a class="reference external" href="http://logback.qos.ch/">Logback</a> for logging flexibility. Configuration is performed via an XML file and there are many different formatting, level and destination options.</p>
<div class="section" id="configuration">
<h2>Configuration</h2>
<p>Logging is configured via a <cite>logback.xml</cite> file. When installing via a package or Docker image, the config is already included. E.g for Docker it will be in the image under <cite>/usr/share/opentsdb/conf/logback.xml</cite> though the location can be overridden via an environment variable <cite>LOGBACK</cite>. When building from source, check the <cite>distribution</cite> module for default logback.xml files.</p>
<div class="section" id="levels">
<h3>Levels</h3>
<p>Every log message is accompanied by a descriptive severity level. Levels employed by OpenTSDB include:</p>
<ul class="simple">
<li><p><strong>ERROR</strong> - Something failed, be it invalid data, a failed connection or a bug in the code. You should pay attention to these and figure out what caused the error. Check with the user group for assistance.</p></li>
<li><p><strong>WARN</strong> - These are often caused by bad user data or something else that was wrong but not a critical error. Look for warnings if you are not receiving the results you expect when using OpenTSDB.</p></li>
<li><p><strong>INFO</strong> - Informational messages are notifications of expected or normal behavior. They can be useful during troubleshooting. Most logging appenders should be set to <code class="docutils literal notranslate"><span class="pre">INFO</span></code>.</p></li>
<li><p><strong>DEBUG</strong> - If you require further troubleshooting you can enable <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> logging that will give much greater detail about what OpenTSDB is doing under the hood. Be careful enabling this level as it can return a vast amount of data.</p></li>
<li><p><strong>OFF</strong> - To drop any logging messages from a class, simply set the level to <code class="docutils literal notranslate"><span class="pre">OFF</span></code>.</p></li>
</ul>
</div>
</div>
<div class="section" id="appenders">
<h2>Appenders</h2>
<p>Appenders are destinations where logging information is sent. Typically logging configs send results to the console and a file. Optionally you can send logs to Syslog, email, sockets, databases and more. Each appender section defines a destination, a format and an optional trigger. Read about appenders in the <a class="reference external" href="http://logback.qos.ch/manual/appenders.html">Logback Manual</a>.</p>
</div>
<div class="section" id="loggers">
<h2>Loggers</h2>
<p>Loggers determine what data and what level of data is routed to the appenders. Loggers can match a particular Java class namespace and affect all messages emitted from that space. The default OpenTSDB config explicitly lists some loggers for Zookeeper, AsyncHBase and the Async libraries to set their levels to <code class="docutils literal notranslate"><span class="pre">INFO</span></code> so as to avoid chatty outputs that are not relevant most of the time. If you enable a plugin and start seeing a lot of messages that you don’t care about, add a logger entry to suppress the messages.</p>
<p><strong>Query Log</strong>
To enable the Query log, find the following section:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;QueryLog&quot;</span> <span class="na">level=</span><span class="s">&quot;OFF&quot;</span> <span class="na">additivity=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;QUERY_LOG&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/logger&gt;</span>
</pre></div>
</div>
<p>and set the <code class="docutils literal notranslate"><span class="pre">level</span></code> to <code class="docutils literal notranslate"><span class="pre">INFO</span></code>.</p>
<p><strong>Log File</strong>
To enable the main log file, find the following section:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!--&lt;appender-ref ref=&quot;FILE&quot;/&gt;--&gt;</span>
</pre></div>
</div>
<p>and remove the comments so it appears as <code class="docutils literal notranslate"><span class="pre">&lt;appender-ref</span> <span class="pre">ref=&quot;FILE&quot;/&gt;</span></code>.</p>
</div>
<div class="section" id="root">
<h2>Root</h2>
<p>The root section is the catch-all logger that determines that default logging level for all messages that don’t match an explicit logger. It also handles routing to the different appenders.</p>
</div>
<div class="section" id="log-to-rotating-file">
<h2>Log to Rotating File</h2>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;FILE&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;file&gt;</span>/var/log/opentsdb/opentsdb.log<span class="nt">&lt;/file&gt;</span>
  <span class="nt">&lt;append&gt;</span>true<span class="nt">&lt;/append&gt;</span>

  <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.FixedWindowRollingPolicy&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;fileNamePattern&gt;</span>/var/log/opentsdb/opentsdb.log.%i<span class="nt">&lt;/fileNamePattern&gt;</span>
    <span class="nt">&lt;minIndex&gt;</span>1<span class="nt">&lt;/minIndex&gt;</span>
    <span class="nt">&lt;maxIndex&gt;</span>3<span class="nt">&lt;/maxIndex&gt;</span>
  <span class="nt">&lt;/rollingPolicy&gt;</span>

  <span class="nt">&lt;triggeringPolicy</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;maxFileSize&gt;</span>128MB<span class="nt">&lt;/maxFileSize&gt;</span>
  <span class="nt">&lt;/triggeringPolicy&gt;</span>

  <span class="c">&lt;!-- encoders are assigned the type</span>
<span class="c">       ch.qos.logback.classic.encoder.PatternLayoutEncoder by default --&gt;</span>
  <span class="nt">&lt;encoder&gt;</span>
    <span class="nt">&lt;pattern&gt;</span>%d{HH:mm:ss.SSS} %-5level [%logger{0}.%M] - %msg%n<span class="nt">&lt;/pattern&gt;</span>
  <span class="nt">&lt;/encoder&gt;</span>
<span class="nt">&lt;/appender&gt;</span>
</pre></div>
</div>
<p>This appender will write to a log file called <code class="docutils literal notranslate"><span class="pre">/var/log/opentsdb/opentsdb.log</span></code>. When the file reaches 128MB in size, it will rotate the log to <code class="docutils literal notranslate"><span class="pre">opentsdb.log.1</span></code> and start a new <code class="docutils literal notranslate"><span class="pre">opentsdb.log</span></code> file. Once the new log fills up, it bumps <code class="docutils literal notranslate"><span class="pre">.1</span></code> to <code class="docutils literal notranslate"><span class="pre">.2</span></code>, <code class="docutils literal notranslate"><span class="pre">.log</span></code> to <code class="docutils literal notranslate"><span class="pre">.1</span></code> and creates a new one. It repeats this until there are four log files in total. The next time the log fills up, the last log is deleted. This way you are gauranteed to only use up to 512MB of disk space. Many other appenders are available so see what fits your needs the best.</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, OpenTSDB.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>