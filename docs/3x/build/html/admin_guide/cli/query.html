<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>query &#8212; OpenTSDB 3.0 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          OpenTSDB</a>
        <span class="navbar-text navbar-version pull-left"><b>3.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://github.com/OpenTSDB/opentsdb/releases">Download</a></li>
                <li><a href="https://github.com/OpenTSDB/opentsdb">Source</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Documentation <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../changes.html">Changes in 3.0</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#new-features">New Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#whats-missing">Whats Missing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation and Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#runtime-requirements">Runtime Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#compile">Compile</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#docker">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#local">Local</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#id1">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#querying">Querying</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/index.html">Users Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/semanticquery/index.html">Semantic Query (Version 3)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Administrators Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../configuration.html">TSDB Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging.html">Logging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api_http/index.html">HTTP API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#version-2-x-to-3-x">Version 2.X to 3.x</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#authentication-permissions">Authentication/Permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#response-codes">Response Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#errors">Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#verbs">Verbs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#query-string-vs-body-content">Query String Vs. Body Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#compressed-requests">Compressed Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#cors">CORS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#deprecated-api">Deprecated API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#api-endpoints">API Endpoints</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">query</a><ul>
<li><a class="reference internal" href="#parameters">Parameters</a></li>
<li><a class="reference internal" href="#output-format">Output Format</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  <div class="section" id="query">
<h1>query</h1>
<p>The query command line tool is meant to be a quick debugging tool for extracting data from OpenTSDB. The HTTP API will usually be much quicker when querying data as it incorprates caches and open connections to storage. Results are printed to stdout in a text format with one data point per line.</p>
<p>Note that a query may return data points before and after the timespan requested. These are used in downsampling and graphing.</p>
<div class="section" id="parameters">
<h2>Parameters</h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>query <span class="o">[</span>Gnuplot opts<span class="o">]</span> START-DATE <span class="o">[</span>END-DATE<span class="o">]</span> &lt;aggregator&gt; <span class="o">[</span>rate<span class="o">]</span> <span class="o">[</span>counter,max,reset<span class="o">]</span> <span class="o">[</span>downsample N FUNC<span class="o">]</span> &lt;metric&gt; <span class="o">[</span>&lt;<span class="nv">tagk</span><span class="o">=</span>tagv&gt;<span class="o">]</span> <span class="o">[</span>...&lt;<span class="nv">tagk</span><span class="o">=</span>tagv&gt;<span class="o">]</span> <span class="o">[</span>...queries<span class="o">]</span>
</pre></div>
</div>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 5%" />
<col style="width: 40%" />
<col style="width: 5%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Example</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Gnuplot opts</p></td>
<td><p>Strings</p></td>
<td><p>Optional values used to generate Gnuplot scripts and graphs. Note that the actual graph PNG will not be generated, only the files (written to the temp directory)</p></td>
<td></td>
<td><p>+wxh=1286x836</p></td>
</tr>
<tr class="row-odd"><td><p>START-DATE</p></td>
<td><p>String or Integer</p></td>
<td><p>Starting time for the query. This may be an absolute or relative time. See <a class="reference internal" href="../query/dates.html"><span class="doc">Dates and Times</span></a> for details</p></td>
<td></td>
<td><p>1h-ago</p></td>
</tr>
<tr class="row-even"><td><p>END-DATE</p></td>
<td><p>String or Integer</p></td>
<td><p>Optional end time for the query. If not provided, the current time is used. This may be an absolute or relative time. See <a class="reference internal" href="../query/dates.html"><span class="doc">Dates and Times</span></a> for details</p></td>
<td><p>Current timestamp</p></td>
<td><p>2014/01/01-00:00:00</p></td>
</tr>
<tr class="row-odd"><td><p>aggregator</p></td>
<td><p>String</p></td>
<td><p>A function to use when multiple timeseries are included in the results</p></td>
<td></td>
<td><p>sum</p></td>
</tr>
<tr class="row-even"><td><p>rate</p></td>
<td><p>String</p></td>
<td><p>The literal <code class="docutils literal notranslate"><span class="pre">rate</span></code> if the timeseries represents a counter and the results should be returned as delta per second</p></td>
<td></td>
<td><p>rate</p></td>
</tr>
<tr class="row-odd"><td><p>counter</p></td>
<td><p>String</p></td>
<td><p>Optional literal <code class="docutils literal notranslate"><span class="pre">counter</span></code> that indicates the underlying data is a monotonically increasong counter that may roll over</p></td>
<td></td>
<td><p>counter</p></td>
</tr>
<tr class="row-even"><td><p>max</p></td>
<td><p>Integer</p></td>
<td><p>A positive integer representing the maximum value for the counter</p></td>
<td><p>Java Long.MaxValue</p></td>
<td><p>65535</p></td>
</tr>
<tr class="row-odd"><td><p>resetValue</p></td>
<td><p>Integer</p></td>
<td><p>An optional value that, when exceeded, will cause the aggregator to return a 0 instead of the calculated rate. Useful when data sources are frequently reset to avoid spurious spikes.</p></td>
<td></td>
<td><p>65000</p></td>
</tr>
<tr class="row-even"><td><p>downsample N FUNC</p></td>
<td><p>String</p></td>
<td><p>Optional downsampling specifier to group data into larger time spans and reduce the amount of data returned. Format is the literal <code class="docutils literal notranslate"><span class="pre">downsample</span></code> followed by a timespan in milliseconds and an aggregation function name</p></td>
<td></td>
<td><p>downsample 300000 avg</p></td>
</tr>
<tr class="row-odd"><td><p>metric</p></td>
<td><p>String</p></td>
<td><p>Required name of a metric to query for</p></td>
<td></td>
<td><p>sys.cpu.user</p></td>
</tr>
<tr class="row-even"><td><p>tagk=tagv</p></td>
<td><p>String</p></td>
<td><p>Optional pairs of tag names and tag values</p></td>
<td></td>
<td><p>host=web01</p></td>
</tr>
<tr class="row-odd"><td><p>additional queries</p></td>
<td><p>String</p></td>
<td><p>Optional additional queries to execute. Each query must follow the same format starting with an aggregator. All queries share the same start and end times.</p></td>
<td></td>
<td><p>sum tsd.hbase.rpcs type=scan</p></td>
</tr>
</tbody>
</table>
<p>For more details on querying, please see <a class="reference internal" href="../query/index.html"><span class="doc">Querying or Reading Data</span></a>.</p>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>query 1h-ago now sum tsd.hbase.rpcs <span class="nv">type</span><span class="o">=</span>put sum tsd.hbase.rpcs <span class="nv">type</span><span class="o">=</span>scan
</pre></div>
</div>
</div>
<div class="section" id="output-format">
<h2>Output Format</h2>
<p>Data is printed to stdout with one data point per line. If one or more Gnuplot options were specified, then scripts and data files for each query will be written to the configured temporary directory.</p>
<blockquote>
<div><p>&lt;metric&gt; &lt;timestamp&gt; &lt;value&gt; {&lt;tagk=tagv&gt;[,..&lt;tagkN=tagvN&gt;]}</p>
</div></blockquote>
<p>Where:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>metric</strong> Is the name of the metric queried</p></li>
<li><p><strong>timestamp</strong> Is the absolute timestamp of the data point in seconds or milliseconds</p></li>
<li><p><strong>value</strong> Is the data point value</p></li>
<li><p><strong>tagk=tagv</strong> Is a list of common tag name and value pairs for all timeseries represented in the query</p></li>
</ul>
</div></blockquote>
<p>Example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tsd.hbase.rpcs <span class="m">1393376401000</span> <span class="m">28067146491</span> <span class="o">{</span><span class="nv">type</span><span class="o">=</span>put, <span class="nv">fqdn</span><span class="o">=</span>tsdb-data-1<span class="o">}</span>
tsd.hbase.rpcs <span class="m">1393376461000</span> <span class="m">28067526510</span> <span class="o">{</span><span class="nv">type</span><span class="o">=</span>put, <span class="nv">fqdn</span><span class="o">=</span>tsdb-data-1<span class="o">}</span>
tsd.hbase.rpcs <span class="m">1393376521000</span> <span class="m">28067826659</span> <span class="o">{</span><span class="nv">type</span><span class="o">=</span>put, <span class="nv">fqdn</span><span class="o">=</span>tsdb-data-1<span class="o">}</span>
tsd.hbase.rpcs <span class="m">1393376581000</span> <span class="m">28068126093</span> <span class="o">{</span><span class="nv">type</span><span class="o">=</span>put, <span class="nv">fqdn</span><span class="o">=</span>tsdb-data-1<span class="o">}</span>
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, OpenTSDB.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>