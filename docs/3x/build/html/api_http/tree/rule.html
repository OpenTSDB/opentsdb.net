<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>/api/tree/rule &#8212; OpenTSDB 3.0 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          OpenTSDB</a>
        <span class="navbar-text navbar-version pull-left"><b>3.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://github.com/OpenTSDB/opentsdb/releases">Download</a></li>
                <li><a href="https://github.com/OpenTSDB/opentsdb">Source</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Documentation <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../changes.html">Changes in 3.0</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#new-features">New Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#whats-missing">Whats Missing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation and Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#runtime-requirements">Runtime Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#compile">Compile</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#docker">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#local">Local</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#id1">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#querying">Querying</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/index.html">Users Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../user_guide/semanticquery/index.html">Semantic Query (Version 3)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../admin_guide/index.html">Administrators Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../admin_guide/configuration.html">TSDB Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../admin_guide/logging.html">Logging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">HTTP API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../index.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#version-2-x-to-3-x">Version 2.X to 3.x</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#authentication-permissions">Authentication/Permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#response-codes">Response Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#errors">Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#verbs">Verbs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#query-string-vs-body-content">Query String Vs. Body Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#compressed-requests">Compressed Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#cors">CORS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#deprecated-api">Deprecated API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#api-endpoints">API Endpoints</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">/api/tree/rule</a><ul>
<li><a class="reference internal" href="#verbs">Verbs</a></li>
<li><a class="reference internal" href="#requests">Requests</a></li>
<li><a class="reference internal" href="#response">Response</a></li>
<li><a class="reference internal" href="#get">GET</a><ul>
<li><a class="reference internal" href="#example-get-query">Example GET Query</a></li>
<li><a class="reference internal" href="#example-response">Example Response</a></li>
</ul>
</li>
<li><a class="reference internal" href="#post-put">POST/PUT</a><ul>
<li><a class="reference internal" href="#example-query-string-request">Example Query String Request</a></li>
<li><a class="reference internal" href="#example-content-request">Example Content Request</a></li>
<li><a class="reference internal" href="#id5">Example Response</a></li>
</ul>
</li>
<li><a class="reference internal" href="#delete">DELETE</a><ul>
<li><a class="reference internal" href="#example-delete-request">Example DELETE Request</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  <div class="section" id="api-tree-rule">
<h1>/api/tree/rule</h1>
<p>Each rule in a tree is an individual object in storage, thus the <code class="docutils literal notranslate"><span class="pre">/api/tree/rule</span></code> endpoint allows for easy modification of a single rule in the set. Rules are addressed by their <code class="docutils literal notranslate"><span class="pre">tree</span></code> ID, <code class="docutils literal notranslate"><span class="pre">level</span></code> and <code class="docutils literal notranslate"><span class="pre">order</span></code> and all requests require these three parameters.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a manual tree synchronization is running somewhere or there is a large number of TSMeta objects being created or edited, the tree rule may be cached and modifications to a tree’s rule set may take some time to propagate. If you make any modifications to the rule set, other than to meta information such as the <code class="docutils literal notranslate"><span class="pre">description</span></code> and <code class="docutils literal notranslate"><span class="pre">notes</span></code>, you may want to flush the tree data and perform a manual synchronization so that branches and leaves reflect the new rules.</p>
</div>
<div class="section" id="verbs">
<h2>Verbs</h2>
<ul class="simple">
<li><p>GET - Retrieve one or more rules</p></li>
<li><p>POST - Create or modify a rule</p></li>
<li><p>PUT - Create or replace a rule</p></li>
<li><p>DELETE - Delete a rule</p></li>
</ul>
</div>
<div class="section" id="requests">
<h2>Requests</h2>
<p>The following fields can be used for all rule endpoint requests:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 45%" />
<col style="width: 10%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 15%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Required</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>QS</p></th>
<th class="head"><p>RW</p></th>
<th class="head"><p>Example</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>treeId</p></td>
<td><p>Integer</p></td>
<td><p>Required</p></td>
<td><p>The tree the requested rule belongs to</p></td>
<td></td>
<td><p>treeid</p></td>
<td><p>RO</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>level</p></td>
<td><p>Integer</p></td>
<td><p>Required</p></td>
<td><p>The level in the rule heirarchy where the rule resides. Must be 0 or greater.</p></td>
<td><p>0</p></td>
<td><p>level</p></td>
<td><p>RW</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>order</p></td>
<td><p>Integer</p></td>
<td><p>Required</p></td>
<td><p>The order within a level where the rule resides. Must be 0 or greater.</p></td>
<td><p>0</p></td>
<td><p>order</p></td>
<td><p>RW</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>description</p></td>
<td><p>String</p></td>
<td><p>Optional</p></td>
<td><p>A brief description of the rule’s purpose</p></td>
<td></td>
<td><p>description</p></td>
<td><p>RW</p></td>
<td><p>Split the metric by dot</p></td>
</tr>
<tr class="row-even"><td><p>notes</p></td>
<td><p>String</p></td>
<td><p>Optional</p></td>
<td><p>Detailed notes about the rule</p></td>
<td></td>
<td><p>notes</p></td>
<td><p>RW</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>type</p></td>
<td><p>String</p></td>
<td><p>Required*</p></td>
<td><p>The type of rule represented. See <span class="xref std std-doc">../../user_guide/trees</span>. <a href="#id1"><span class="problematic" id="id2">*</span></a>Required when creating a new rule.</p></td>
<td></td>
<td><p>type</p></td>
<td><p>RW</p></td>
<td><p>METRIC</p></td>
</tr>
<tr class="row-even"><td><p>field</p></td>
<td><p>String</p></td>
<td><p>Optional</p></td>
<td><p>The name of a field for the rule to operate on</p></td>
<td></td>
<td><p>field</p></td>
<td><p>RW</p></td>
<td><p>host</p></td>
</tr>
<tr class="row-odd"><td><p>customField</p></td>
<td><p>String</p></td>
<td><p>Optional</p></td>
<td><p>The name of a <code class="docutils literal notranslate"><span class="pre">TSMeta</span></code> custom field for the rule to operate on. Note that the <code class="docutils literal notranslate"><span class="pre">field</span></code> value must also be configured or an exception will be raised.</p></td>
<td></td>
<td><p>custom_field</p></td>
<td><p>RW</p></td>
<td><p>owner</p></td>
</tr>
<tr class="row-even"><td><p>regex</p></td>
<td><p>String</p></td>
<td><p>Optional</p></td>
<td><p>A regular expression pattern to process the associated field or custom field value through.</p></td>
<td></td>
<td><p>regex</p></td>
<td><p>RW</p></td>
<td><p>^.*\.([a-zA-Z]{3,4})[0-9]{0,1}\..*\..*$</p></td>
</tr>
<tr class="row-odd"><td><p>separator</p></td>
<td><p>String</p></td>
<td><p>Optional</p></td>
<td><p>If the field value should be split into multiple branches, provide the separation character.</p></td>
<td></td>
<td><p>separator</p></td>
<td><p>RW</p></td>
<td><p>\.</p></td>
</tr>
<tr class="row-even"><td><p>regexGroupIdx</p></td>
<td><p>Integer</p></td>
<td><p>Optional</p></td>
<td><p>A group index for extracting a portion of a pattern from the given regular expression pattern. Must be 0 or greater.</p></td>
<td><p>0</p></td>
<td><p>regex_group_idx</p></td>
<td><p>RW</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>displayFormat</p></td>
<td><p>String</p></td>
<td><p>Optional</p></td>
<td><p>A display format string to alter the <code class="docutils literal notranslate"><span class="pre">display_name</span></code> value of the resulting branch or leaf. See <span class="xref std std-doc">../../user_guide/trees</span></p></td>
<td></td>
<td><p>display_format</p></td>
<td><p>RW</p></td>
<td><p>Port: {ovalue}</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When supplying a <code class="docutils literal notranslate"><span class="pre">separator</span></code> or a <code class="docutils literal notranslate"><span class="pre">regex</span></code> value, you must supply a valid regular expression. For separators, the most common use is to split dotted metrics into branches. E.g. you may want “sys.cpu.0.user” to be split into “sys”, “cpu”, “0” and “user” branches. You cannot supply just a “.” for the separator value as that will not match properly. Instead, escape the period via “.”. Note that if you are supplying JSON via a POST request, you must escape the backslash as well and supply “\.”. GET request responses will escape all backslashes.</p>
</div>
</div>
<div class="section" id="response">
<h2>Response</h2>
<p>A successful response to a <code class="docutils literal notranslate"><span class="pre">GET</span></code>, <code class="docutils literal notranslate"><span class="pre">POST</span></code> or <code class="docutils literal notranslate"><span class="pre">PUT</span></code> request will return the full rule object with optional requested changes. Successful <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> calls will return with a <code class="docutils literal notranslate"><span class="pre">204</span></code> status code and no body content. When modifying data, if no changes were present, i.e. the call did not provide any data to store, the resposne will be a <code class="docutils literal notranslate"><span class="pre">304</span></code> without any body content. If the requested tree or rule did not exist in the system, a <code class="docutils literal notranslate"><span class="pre">404</span></code> will be returned with an error message. If invalid data was supplied a <code class="docutils literal notranslate"><span class="pre">400</span></code> error will be returned.</p>
</div>
<div class="section" id="get">
<h2>GET</h2>
<p>A <code class="docutils literal notranslate"><span class="pre">GET</span></code> request requires a specific tree ID, rule level and order. Otherwise a <code class="docutils literal notranslate"><span class="pre">400</span></code> will be returned. To fetch all of the rules for a tree, use the <code class="docutils literal notranslate"><span class="pre">/api/tree</span></code> endpoint with a <a href="#id3"><span class="problematic" id="id4">``</span></a>treeId’ value.</p>
<div class="section" id="example-get-query">
<h3>Example GET Query</h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://localhost:4242/api/tree/rule?treeId=1&amp;level=0&amp;order=0
</pre></div>
</div>
</div>
<div class="section" id="example-response">
<h3>Example Response</h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;METRIC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;field&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;regex&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;separator&quot;</span><span class="o">:</span> <span class="s2">&quot;\\.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Split the metric on periods&quot;</span><span class="p">,</span>
    <span class="s2">&quot;notes&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;level&quot;</span><span class="o">:</span> <span class="mf">1</span><span class="p">,</span>
    <span class="s2">&quot;order&quot;</span><span class="o">:</span> <span class="mf">0</span><span class="p">,</span>
    <span class="s2">&quot;treeId&quot;</span><span class="o">:</span> <span class="mf">1</span><span class="p">,</span>
    <span class="s2">&quot;customField&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;regexGroupIdx&quot;</span><span class="o">:</span> <span class="mf">0</span><span class="p">,</span>
    <span class="s2">&quot;displayFormat&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="post-put">
<h2>POST/PUT</h2>
<p>Using the <code class="docutils literal notranslate"><span class="pre">POST</span></code> or <code class="docutils literal notranslate"><span class="pre">PUT</span></code> methods, you can create a new rule or edit an existing rule. New rules require a <code class="docutils literal notranslate"><span class="pre">type</span></code> value. Existing trees require a valid <code class="docutils literal notranslate"><span class="pre">treeId</span></code> ID and any fields that require modification. A successful request will return the modified rule object. Note that if a rule exists at the given level and order, any changes will be merged with or overwrite the existing rule.</p>
<div class="section" id="example-query-string-request">
<h3>Example Query String Request</h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://localhost:4242/api/tree/rule?treeId=1&amp;level=0&amp;order=0&amp;type=METRIC&amp;separator=\.&amp;method_override=post
</pre></div>
</div>
</div>
<div class="section" id="example-content-request">
<h3>Example Content Request</h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;METRIC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;separator&quot;</span><span class="o">:</span> <span class="s2">&quot;\\.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Split the metric on periods&quot;</span><span class="p">,</span>
    <span class="s2">&quot;level&quot;</span><span class="o">:</span> <span class="mf">1</span><span class="p">,</span>
    <span class="s2">&quot;order&quot;</span><span class="o">:</span> <span class="mf">0</span><span class="p">,</span>
    <span class="s2">&quot;treeId&quot;</span><span class="o">:</span> <span class="mf">1</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>Example Response</h3>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;METRIC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;field&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;regex&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;separator&quot;</span><span class="o">:</span> <span class="s2">&quot;\\.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;Split the metric on periods&quot;</span><span class="p">,</span>
    <span class="s2">&quot;notes&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;level&quot;</span><span class="o">:</span> <span class="mf">1</span><span class="p">,</span>
    <span class="s2">&quot;order&quot;</span><span class="o">:</span> <span class="mf">0</span><span class="p">,</span>
    <span class="s2">&quot;treeId&quot;</span><span class="o">:</span> <span class="mf">1</span><span class="p">,</span>
    <span class="s2">&quot;customField&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;regexGroupIdx&quot;</span><span class="o">:</span> <span class="mf">0</span><span class="p">,</span>
    <span class="s2">&quot;displayFormat&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="delete">
<h2>DELETE</h2>
<p>Using the <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> method will remove a rule from a tree. A successful deletion will respond with a <code class="docutils literal notranslate"><span class="pre">204</span></code> status code and no content body. If the rule did not exist, a <code class="docutils literal notranslate"><span class="pre">404</span></code> error will be returned.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This method cannot be undone.</p>
</div>
<div class="section" id="example-delete-request">
<h3>Example DELETE Request</h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://localhost:4242/api/tree/rule?treeId=1&amp;level=0&amp;order=0&amp;method_override=delete
</pre></div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2021, OpenTSDB.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>