<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Downsample &#8212; OpenTSDB 3.0 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Expression" href="expression.html" />
    <link rel="prev" title="Semantic Query (Version 3)" href="index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-inverse navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          OpenTSDB</a>
        <span class="navbar-text navbar-version pull-left"><b>3.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://github.com/OpenTSDB/opentsdb/releases">Download</a></li>
                <li><a href="https://github.com/OpenTSDB/opentsdb">Source</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Documentation <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../changes.html">Changes in 3.0</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#new-features">New Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../changes.html#whats-missing">Whats Missing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation and Quick Start</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#runtime-requirements">Runtime Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#compile">Compile</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#docker">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#local">Local</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#id1">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation.html#querying">Querying</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Users Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Semantic Query (Version 3)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../admin_guide/index.html">Administrators Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../admin_guide/configuration.html">TSDB Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../admin_guide/logging.html">Logging</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api_http/index.html">HTTP API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#version-2-x-to-3-x">Version 2.X to 3.x</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#authentication-permissions">Authentication/Permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#response-codes">Response Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#errors">Errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#verbs">Verbs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#query-string-vs-body-content">Query String Vs. Body Content</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#compressed-requests">Compressed Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#cors">CORS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#documentation">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#deprecated-api">Deprecated API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_http/index.html#api-endpoints">API Endpoints</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="index.html" title="Previous Chapter: Semantic Query (Version 3)"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Semantic Quer...</span>
    </a>
  </li>
  <li>
    <a href="expression.html" title="Next Chapter: Expression"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Expression &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Downsample</a><ul>
<li><a class="reference internal" href="#timespecification">timeSpecification</a></li>
<li><a class="reference internal" href="#auto-intervals">Auto Intervals</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  <div class="section" id="downsample">
<h1>Downsample</h1>
<p>Normalizes and/or reduces the resolution of the source data. For example, if data comes in every second and you want to plot a week of data, that would be too many data points for most graph libraries to handle. Instead, downsample the data to emit a value every hour and it will be much more legible as well as making the query faster as there is less data to serialize and less data to work on upstream of the downsample node.</p>
<p>The 3.0 downsampler offers some new features including auto downsampling, infectious NaNs as well as interpolation and fill policies.</p>
<p>Fields for the downsample config include:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 45%" />
<col style="width: 10%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Data Type</p></th>
<th class="head"><p>Required</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default</p></th>
<th class="head"><p>Example</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>interval</p></td>
<td><p>String</p></td>
<td><p>Required</p></td>
<td><p>The new resolution (or size of buckets) to convert the data to. Formated as a TSDB duration. May also be <code class="docutils literal notranslate"><span class="pre">0all</span></code> if <code class="docutils literal notranslate"><span class="pre">runAll</span></code> is set to true in which case the full query timespan is aggregated into a single value. May also be <code class="docutils literal notranslate"><span class="pre">auto</span></code> for automatic downsampling based on the query span.</p></td>
<td><p>null</p></td>
<td><p>1m</p></td>
</tr>
<tr class="row-odd"><td><p>aggregator</p></td>
<td><p>String</p></td>
<td><p>Required</p></td>
<td><p>The ID of a registered aggregation function in the Registry to use when merging multiple values into a downsample bucket.</p></td>
<td><p>null</p></td>
<td><p>sum</p></td>
</tr>
<tr class="row-even"><td><p>infectiousNan</p></td>
<td><p>boolean</p></td>
<td><p>Optional</p></td>
<td><p>Whether or not NaNs from the source data should infect each bucket when aggregating values. E.g. if one value out of 20 are <code class="docutils literal notranslate"><span class="pre">NaN</span></code> in a bucket and this is true, the bucket will return a <code class="docutils literal notranslate"><span class="pre">NaN</span></code>. If all values in a bucket are <code class="docutils literal notranslate"><span class="pre">NaN</span></code> then the result will be <code class="docutils literal notranslate"><span class="pre">NaN</span></code> regardless..</p></td>
<td><p>false</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-odd"><td><p>runAll</p></td>
<td><p>Boolean</p></td>
<td><p>Optional</p></td>
<td><p>Whether or not to merge all of the values for the query span into a single resulting bucket.</p></td>
<td><p>false</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>fill</p></td>
<td><p>boolean</p></td>
<td><p>Optional</p></td>
<td><p>Whether or not to fill empty buckets with values based on the <code class="docutils literal notranslate"><span class="pre">interpolatorConfig</span></code>. If false, then empty buckets return <code class="docutils literal notranslate"><span class="pre">null</span></code> or <code class="docutils literal notranslate"><span class="pre">NaN</span></code>.</p></td>
<td><p>false</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-odd"><td><p>minInterval</p></td>
<td><p>String</p></td>
<td><p>Optional</p></td>
<td><p><strong>NOTE</strong> This is temporary, weâ€™ll clean it out and use <code class="docutils literal notranslate"><span class="pre">reportingInterval</span></code> instead. An optional minimum interval to use when <code class="docutils literal notranslate"><span class="pre">auto</span></code> is set as the primary <code class="docutils literal notranslate"><span class="pre">interval</span></code>. This is useful for metrics that may be reported on a <code class="docutils literal notranslate"><span class="pre">5m</span></code> interval to avoid extraneous fills when downsampling would be set to <code class="docutils literal notranslate"><span class="pre">1m</span></code> with auto based on the query interval.</p></td>
<td><p>null</p></td>
<td><p>5m</p></td>
</tr>
<tr class="row-even"><td><p>reportingInterval</p></td>
<td><p>String</p></td>
<td><p>Optional</p></td>
<td><p>When known, the reporting interval of the metric coming through and is used by some query nodes to compute more accurate values, e.g. the rate to count functon.</p></td>
<td><p>null</p></td>
<td><p>5m</p></td>
</tr>
<tr class="row-odd"><td><p>timeZone</p></td>
<td><p>String</p></td>
<td><p>Optional</p></td>
<td><p>An optional Java time zone ID that, when given, switches the downsampling to calendar mode where bucket boundaries are computed based on the time zone, e.g. accounting for daylight savings and offsets from UTC.</p></td>
<td><p>null</p></td>
<td><p>America/Denver</p></td>
</tr>
<tr class="row-even"><td><p>interpolatorConfig</p></td>
<td><p>List</p></td>
<td><p>Required <em>for now</em></p></td>
<td><p>A list of interpolator configs for the downsampler to deal with empty buckets.</p></td>
<td><p>null</p></td>
<td><p>See <a class="reference internal" href="interpolator.html"><span class="doc">Interpolators</span></a></p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When a downsample node is present in a query graph and the output is the standard V3 serializer, a <code class="docutils literal notranslate"><span class="pre">timeSpecification</span></code> will be present in the output and the values will be serialized in an array without timestamps.</p>
</div>
<p>Example:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;cpu_ds&quot;</span><span class="p">,</span>
  <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;downsample&quot;</span><span class="p">,</span>
  <span class="s2">&quot;aggregator&quot;</span><span class="o">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
  <span class="s2">&quot;interval&quot;</span><span class="o">:</span> <span class="s2">&quot;5m&quot;</span><span class="p">,</span>
  <span class="s2">&quot;fill&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">&quot;interpolatorConfigs&quot;</span><span class="o">:</span> <span class="p">[{</span>
    <span class="s2">&quot;dataType&quot;</span><span class="o">:</span> <span class="s2">&quot;numeric&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fillPolicy&quot;</span><span class="o">:</span> <span class="s2">&quot;NAN&quot;</span><span class="p">,</span>
    <span class="s2">&quot;realFillPolicy&quot;</span><span class="o">:</span> <span class="s2">&quot;NONE&quot;</span>
  <span class="p">}],</span>
  <span class="s2">&quot;sources&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;m1&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="timespecification">
<h2>timeSpecification</h2>
<p>When downsampling is present, a time specifications will be serialized in the output of the query, saving time and bytes over the wire as the query no longer needs to serialize timestamps. The time specification in a v3 query output has the following fields:</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>start</p></td>
<td><p>The first timestamp in Unix Epoch seconds (or milliseconds if requested).</p></td>
</tr>
<tr class="row-odd"><td><p>end</p></td>
<td><p>The last timestamp in Unix Epoch seconds (or milliseconds if requested).</p></td>
</tr>
<tr class="row-even"><td><p>intervalISO</p></td>
<td><p>The interval of the downsample in ISO format.</p></td>
</tr>
<tr class="row-odd"><td><p>interval</p></td>
<td><p>The interval as a TSDB duration.</p></td>
</tr>
<tr class="row-even"><td><p>timeZone</p></td>
<td><p>The timezone of the downsampler.</p></td>
</tr>
<tr class="row-odd"><td><p>units</p></td>
<td><p>The units of the downsample interval.</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When representing data in a plot or with a timestamp, if the <code class="docutils literal notranslate"><span class="pre">timeZone</span></code> is NOT equal to UTC, make sure to use a library to add the interval to the start for each bucket. This make sure the results will line up with daylight savings changes, etc.</p>
</div>
</div>
<div class="section" id="auto-intervals">
<h2>Auto Intervals</h2>
<p>When <code class="docutils literal notranslate"><span class="pre">auto</span></code> is used in the interval and configured in the TSD, the TSD will take the start and end time of the query and compute a downsample that would return at most about 400 data points for the query range. A stepping configuration is used to determine the final resolution. By default, this stepping config is:</p>
<ul class="simple">
<li><p>&lt; 6h use <code class="docutils literal notranslate"><span class="pre">1m</span></code></p></li>
<li><p>&gt;= 6h and &lt; 12h use <code class="docutils literal notranslate"><span class="pre">15m</span></code></p></li>
<li><p>&gt;= 12h and &lt; 3d use <code class="docutils literal notranslate"><span class="pre">1h</span></code></p></li>
<li><p>&gt;= 3d and &lt; 1w use <code class="docutils literal notranslate"><span class="pre">6h</span></code></p></li>
<li><p>&gt;= 1w and &lt; 1 month use <code class="docutils literal notranslate"><span class="pre">1d</span></code></p></li>
<li><p>&gt;= 1 month use <code class="docutils literal notranslate"><span class="pre">1w</span></code></p></li>
</ul>
<p>To override this configuration, use the <code class="docutils literal notranslate"><span class="pre">tsd.query.downsample.auto.config</span></code> property. An example looks like:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span># ---------- DOWNSAMPLE ----------
tsd.query.downsample.auto.config:
  75d: 1d
  2n: 4h
  1n: 2h
  1w: 1h
  2d: 10m
  1d: 5m
  0: 1m
</pre></div>
</div>
<p>Where the configuration is a map where the key is the query interval and the value is the downsample interval to use. E.g. for queries from 1 second to 4 hours, use <code class="docutils literal notranslate"><span class="pre">1m</span></code> as the interval. For 1 day to 2 days, use <code class="docutils literal notranslate"><span class="pre">5m</span></code> as the interval. Anything greater than or equal to 75 days will use <code class="docutils literal notranslate"><span class="pre">1d</span></code> as the interval.</p>
</div>
<div class="section" id="example">
<h2>Example</h2>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;start&quot;</span><span class="o">:</span> <span class="s2">&quot;1h-ago&quot;</span><span class="p">,</span>
    <span class="s2">&quot;executionGraph&quot;</span><span class="o">:</span> <span class="p">[{</span>
                    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;m1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;TimeSeriesDataSource&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;metric&quot;</span><span class="o">:</span> <span class="p">{</span>
                            <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;MetricLiteral&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;metric&quot;</span><span class="o">:</span> <span class="s2">&quot;sys.if.in&quot;</span>
                    <span class="p">}</span>
            <span class="p">},</span>
            <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;ds1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;downsample&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;aggregator&quot;</span><span class="o">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;interval&quot;</span><span class="o">:</span> <span class="s2">&quot;1m&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;runAll&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
                    <span class="s2">&quot;fill&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                    <span class="s2">&quot;interpolatorConfigs&quot;</span><span class="o">:</span> <span class="p">[{</span>
                            <span class="s2">&quot;dataType&quot;</span><span class="o">:</span> <span class="s2">&quot;numeric&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;fillPolicy&quot;</span><span class="o">:</span> <span class="s2">&quot;NAN&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;realFillPolicy&quot;</span><span class="o">:</span> <span class="s2">&quot;NONE&quot;</span>
                    <span class="p">}],</span>
                    <span class="s2">&quot;sources&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;m1&quot;</span><span class="p">]</span>
            <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, OpenTSDB.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>